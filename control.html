<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>操作パネル</title>
    <style>
        /* bodyタグ: ページ全体の基本的な設定です */
        body {
            /* 文字のフォントを指定します */
            font-family: sans-serif;
            /* 中身を中央揃えにします */
            text-align: center;
            /* ページの端から少し内側に余白を設けます */
            padding: 1em;
        }
        /* ▼▼▼▼▼ パスワード画面用のCSSを追加 ▼▼▼▼▼ */
        /* パスワード入力フォームのコンテナ */
        #password-prompt {
            /* 上からの余白を大きく取ります */
            margin-top: 200px;
        }
        /* パスワード入力欄 */
        #password-input {
            /* 文字の大きさを指定 */
            font-size: 18px;
            /* 内側の余白を指定 */
            padding: 10px;
            /* 横幅を指定 */
            width: 200px;
        }
        /* 送信ボタン */
        #password-submit {
            /* 文字の大きさを指定 */
            font-size: 18px;
            /* 内側の余白を指定 */
            padding: 10px 20px;
        }

        /* 記号ボタンを囲むdivタグ用の設定です */
        #symbol-buttons {
            /* Flexboxというレイアウト方法を使うことを宣言します */
            display: flex;
            /* 中身のアイテム（ボタン）を水平方向の中央に配置します */
            justify-content: center;
        }

        /* idがsymbol-buttonsの中にあるbuttonタグにだけ適用される設定です */
        #symbol-buttons button {
            /* 文字の大きさを50ピクセルにします */
            font-size: 50px;
            /* ボタンの横幅を100ピクセルにします */
            width: 100px;
            /* ボタンの高さを100ピクセルにします */
            height: 100px;
            /* ボタンの外側の余白を上下左右に15ピクセル設けます */
            margin: 15px;
            /* マウスカーソルを乗せたときに指の形になるようにします */
            cursor: pointer;
            /* ボタン内部の記号の色を設定 */
            color: #555;
            /* ボタンの枠線を設定します */
            border: 2px solid #ccc;
            /* 角を少し丸くします */
            border-radius: 5px;
            /* ボタンの背景色を白色にします */
            background-color: #fff;
            /* 色が変わるアニメーションを0.3秒かけて滑らかにします */
            transition: background-color 0.3s, border-color 0.3s;
            
            /* --- ここから下は、ボタンの中の記号を真ん中に配置するための設定です --- */
            /* ボタンの中身もFlexboxで配置します */
            display: flex;
            /* ボタンの中身を水平方向の中央に配置します */
            justify-content: center;
            /* ボタンの中身を垂直方向の中央に配置します */
            align-items: center;
            /* 文字の行の高さを調整してズレを防ぎます */
            line-height: 1;
            /* ボタンの内側の余白をなくします */
            padding: 0;
        }
        
        /* ▼▼▼▼▼ ここから下が、選択中のボタンのデザイン設定です ▼▼▼▼▼ */
        /* 'active-circle'クラスが付いたボタンのデザイン */
        #symbol-buttons button.active-circle {
            background-color: #e6ffed; /* 背景を淡い緑に */
            border-color: #28a745;   /* 枠線を緑に */
            color: #28a745;
        }
        /* 'active-triangle'クラスが付いたボタンのデザイン */
        #symbol-buttons button.active-triangle {
            background-color: #fff8e1; /* 背景を淡いオレンジに */
            border-color: #ffc107;   /* 枠線をオレンジに */
            color: #ffc107;
        }
        /* 'active-cross'クラスが付いたボタンのデザイン */
        #symbol-buttons button.active-cross {
            background-color: #ffebee; /* 背景を淡い赤に */
            border-color: #dc3545;   /* 枠線を赤に */
            color: #dc3545;
        }
        /* ▲▲▲▲▲ ここまで ▲▲▲▲▲ */

        /* 備考欄のセクション用の設定です */
        #remarks-section {
            /* 上側に30ピクセルの余白を設けます */
            margin-top: 30px;
        }
        
        /* 備考の入力欄(input)用の設定です */
        #remarksInput {
            /* 横幅を親要素の80%にします */
            width: 80%;
            /* 内側の余白を10ピクセル設けます */
            padding: 10px;
            /* 文字の大きさを16ピクセルにします */
            font-size: 16px;
            /* 下側に10ピクセルの余白を設けます */
            margin-bottom: 10px;
        }

        /* 「備考を更新」ボタン用の設定です */
        #updateRemarksBtn {
            /* 横幅を親要素の60%にします */
            width: 60%;
            /* 内側の余白を上下に15ピクセル設けます */
            padding: 15px;
            /* 文字の大きさを18ピクセルにします */
            font-size: 18px;
            /* 背景色を青色にします */
            background-color: #007bff;
            /* 文字色を白色にします */
            color: white;
            /* 枠線をなくします */
            border: none;
            /* 角を少し丸くします */
            border-radius: 5px;
            /* 上のボタンとの間に余白を設けます */
            margin-top: 20px;
        }
        /* 「入力欄をクリア」ボタン用の設定を追加 */
        #clearRemarksBtn {
            /* 横幅を親要素の80%にします */
            width: 60%;
            /* 内側の余白を少し小さめにします */
            padding: 1px;
            /* 文字の大きさを16ピクセルにします */
            font-size: 16px;
            /* 文字色を灰色にします */
            color: #555;
            /* 背景色を白色にします */
            background-color: #fff;
            /* 枠線をなくします */
            border: none;
            /* 上のボタンとの間に余白を設けます */
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="password-prompt">
        <h2>roomStatus</h2>
        <p>status manager</p>
        <input type="password" id="password-input" placeholder="PASSWORD">
        <button id="password-submit">送信</button>
    </div>
   <main id="main-content" style="display: none;">
    <h1>roomStatus</h1>
    <div id="symbol-buttons">
        <button id="circleBtn">○</button>
        <button id="triangleBtn">△</button>
        <button id="crossBtn">×</button>
    </div>

    <div id="remarks-section">
        <h2>備考</h2>
        <input type="text" id="remarksInput" placeholder="例：ミーティング">
        <button id="updateRemarksBtn">更新</button>
        <button id="clearRemarksBtn">クリア</button>
    </div>
       </main>

    <script type="module">
        // --- ここから下がパスワード認証の処理です ---
        
        // 正しいパスワードを設定します。必ず変更してください。
        const CORRECT_PASSWORD = 'hiroya168';

        // HTMLからパスワード関連の要素を取得します
        const passwordPrompt = document.getElementById('password-prompt');
        const mainContent = document.getElementById('main-content');
        const passwordInput = document.getElementById('password-input');
        const passwordSubmit = document.getElementById('password-submit');

        // パスワード送信ボタンがクリックされたときの処理
        passwordSubmit.onclick = () => {
            // 入力された値が正しいパスワードと一致するかチェック
            if (passwordInput.value === CORRECT_PASSWORD) {
                // 一致した場合
                // パスワード入力画面を非表示にする
                passwordPrompt.style.display = 'none';
                // メインの操作画面を表示する
                mainContent.style.display = 'block';
            } else {
                // 一致しなかった場合
                // エラーメッセージを表示
                alert('パスワードが違います。');
                // 入力欄を空にする
                passwordInput.value = '';
            }
        };

        // ▼▼▼▼▼ あなたのfirebaseConfig（Firebaseの設定情報）をここに貼り付けます ▼▼▼▼▼
        const firebaseConfig = {
            apiKey: "AIzaSyApeciQMRZp47i1S5I28eUDGCwUIJx46o4",
            authDomain: "roomstatus-7b0c4.firebaseapp.com",
            databaseURL: "https://roomstatus-7b0c4-default-rtdb.firebaseio.com",
            projectId: "roomstatus-7b0c4",
            storageBucket: "roomstatus-7b0c4.firebasestorage.app",
            messagingSenderId: "355762487600",
            appId: "1:355762487600:web:c27907db8d4c8de18608f5",
            measurementId: "G-NRH5D6E3G0"
        };
        // ▲▲▲▲▲ ここまで ▲▲▲▲▲

        // Firebaseのプログラム（initializeApp）を読み込みます
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        // Firebaseデータベースのプログラムを読み込みます(onValueを追加)
        import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

        // 上で設定したfirebaseConfigを使って、Firebaseアプリを初期化（準備）します
        const app = initializeApp(firebaseConfig);
        // 初期化したアプリから、データベース機能を使えるようにします
        const db = getDatabase(app);
        // データベースの中の'room/status'という場所を参照（ターゲットに設定）します
        const statusRef = ref(db, 'room/status');

        // HTMLの中からidが'circleBtn'の要素（○ボタン）を探して、変数に入れます
        const circleBtn = document.getElementById('circleBtn');
        // HTMLの中からidが'triangleBtn'の要素（△ボタン）を探して、変数に入れます
        const triangleBtn = document.getElementById('triangleBtn');
        // HTMLの中からidが'crossBtn'の要素（×ボタン）を探して、変数に入れます
        const crossBtn = document.getElementById('crossBtn');
        // HTMLの中からidが'remarksInput'の要素（備考入力欄）を探して、変数に入れます
        const remarksInput = document.getElementById('remarksInput');
        // HTMLの中からidが'updateRemarksBtn'の要素（備考更新ボタン）を探して、変数に入れます
        const updateRemarksBtn = document.getElementById('updateRemarksBtn');
        // HTMLの中からidが'clearRemarksBtn'の要素（クリアボタン）を探して、変数に入れます
        const clearRemarksBtn = document.getElementById('clearRemarksBtn');

        // 記号ボタンが押されたときに行う処理を、updateSymbolという名前でひとまとめにします
        const updateSymbol = (newSymbol) => {
            // データベースの'room/status'に、新しい記号と空の備考を書き込みます
            set(statusRef, { symbol: newSymbol, text: '' });
            // 備考の入力欄を空にします
            remarksInput.value = '';
        };

        // ○ボタンがクリックされたら、updateSymbol処理を'○'という文字を渡して実行します
        circleBtn.onclick = () => updateSymbol('○');
        // △ボタンがクリックされたら、updateSymbol処理を'△'という文字を渡して実行します
        triangleBtn.onclick = () => updateSymbol('△');
        // ×ボタンがクリックされたら、updateSymbol処理を'×'という文字を渡して実行します
        crossBtn.onclick = () => updateSymbol('×');
        
        // 「備考を更新」ボタンがクリックされたときの処理です
        updateRemarksBtn.onclick = async () => {
            // 備考入力欄に入力されている文字を取得します
            const newText = remarksInput.value;
            // データベースから現在の情報を一度だけ取得します
            const snapshot = await get(statusRef);
            // 現在設定されている記号を取得します。もし何もなければ'○'を初期値とします
            const currentSymbol = snapshot.val()?.symbol || '○';
            
            // データベースに、現在の記号と新しい備考を書き込みます
            set(statusRef, { symbol: currentSymbol, text: newText });
        };

        // ▼▼▼▼▼ ここからが、データベースの変更を監視してボタンの色を変える処理です ▼▼▼▼▼
        // データベース('room/status')の変更を常に監視します
        onValue(statusRef, (snapshot) => {
            // データベースから現在の状況（記号）を取得します
            const currentSymbol = snapshot.val()?.symbol;

            // まず、すべてのボタンからアクティブ用のクラスを一旦削除します
            circleBtn.classList.remove('active-circle');
            triangleBtn.classList.remove('active-triangle');
            crossBtn.classList.remove('active-cross');

            // 現在の記号に応じて、対応するボタンにだけアクティブ用のクラスを追加します
            if (currentSymbol === '○') {
                // もし記号が'○'なら、○ボタンに'active-circle'クラスを追加
                circleBtn.classList.add('active-circle');
            } else if (currentSymbol === '△') {
                // もし記号が'△'なら、△ボタンに'active-triangle'クラスを追加
                triangleBtn.classList.add('active-triangle');
            } else if (currentSymbol === '×') {
                // もし記号が'×'なら、×ボタンに'active-cross'クラスを追加
                crossBtn.classList.add('active-cross');
            }
        });
        // 「入力欄をクリア」ボタンがクリックされたときの処理です
        clearRemarksBtn.onclick = async () => {
            // 現在設定されている記号をデータベースから取得します
            const snapshot = await get(statusRef);
            // 記号情報を変数に入れます（もし何もなければ'○'を初期値とします）
            const currentSymbol = snapshot.val()?.symbol || '○';
            
            // データベースの備考(text)を空('')にして更新します
            set(statusRef, { symbol: currentSymbol, text: '' });

            // iPhone側の入力欄も空にします
            remarksInput.value = '';
        };
        // ▲▲▲▲▲ ここまで ▲▲▲▲▲

    </script>
</body>
</html>
